---
- name: Check wireguard service | Ensure Wireguard in on latest version
  become: true
  ansible.builtin.apt:
    name: wireguard
    state: latest
    update_cache: true
    force_apt_get: true

- name: Check wireguard service | Check if Wireguard Private key exists on server
  become: true
  ansible.builtin.stat:
    path: /etc/wireguard/private.key
  register: private_key

- name: Check wireguard service | Report missing File, stop deploying
  ansible.builtin.fail:
    msg: >
      Server does not have a wireguard private key present.
      Please investigate why and rerun 'first_run' role.."
  when: not private_key.stat.exists
